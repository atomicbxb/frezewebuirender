<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreezeDroid Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- style.css sudah berisi style dari pertanyaan sebelumnya, akan ditimpa dengan yang baru -->
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-snowflake"></i> FreezeDroid <span class="beta-tag">Web</span></h1>
                <div>
                    {% if current_user.is_authenticated %}
                    <span style="margin-right: 15px; color: var(--text-primary);">User: <strong>{{ current_user.username }}</strong></span>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="logout-button"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </header>

        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="flash-messages-dashboard">
                  {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}

            {% if current_user.is_authenticated %}
            <div class="plan-info">
                Current Plan: <strong>{{ user_plan | default('N/A') }}</strong>
                {% if current_user.plan.name == 'TRIAL' %}
                    {% if current_user.expiry_date %} | Expires: {{ current_user.expiry_date.strftime('%Y-%m-%d') }}{% endif %}
                    | Today's Requests: <span id="trial-requests-today">{{ current_user.requests_today }}</span> / <span id="trial-daily-limit">{{ js_trial_daily_limit | default(10) }}</span>
                {% elif current_user.expiry_date %}
                     | Expires: {{ current_user.expiry_date.strftime('%Y-%m-%d') }}
                {% else %}
                     | No Expiry Set
                {% endif %}
            </div>
            {% endif %}

            <div class="action-panel">
                <section class="action-card" id="single-target-card">
                    <h2><i class="fas fa-user-ninja"></i> Single Target Crash</h2>
                    <form id="singleCrashForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group">
                            <label for="target_number">Target Number:</label>
                            <input type="text" id="target_number" name="target_number" placeholder="e.g., 6281234567890" required>
                        </div>
                        <!-- Tombol akan diubah oleh JavaScript saat loading -->
                        <button type="submit" class="submit-button"><i class="fas fa-rocket"></i> Launch Attack</button>
                    </form>
                    <div id="singleTargetFeedback" class="progress-feedback">Awaiting command...</div>
                </section>

                <section class="action-card" id="multi-target-card">
                    <h2><i class="fas fa-users-cog"></i> Multi-Target Crash</h2>
                    <form id="multiCrashForm" enctype="multipart/form-data">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="form-group">
                            <label for="target_file">Upload .txt File (one number per line):</label>
                            <input type="file" id="target_file" name="target_file" accept=".txt" required>
                        </div>
                         <!-- Tombol akan diubah oleh JavaScript saat loading -->
                        <button type="submit" class="submit-button"><i class="fas fa-network-wired"></i> Launch Barrage</button>
                    </form>
                    <div id="multiTargetFeedback" class="progress-feedback">Awaiting command...</div>
                    <div id="multiTargetProgressBarContainer" class="progress-bar-container" style="display: none;">
                        <div id="multiTargetProgressBar" class="progress-bar"></div>
                    </div>
                </section>
            </div>

            <section class="log-panel">
                <h2><i class="fas fa-scroll"></i> Real-time Log Stream</h2>
                <div id="loading-indicator" style="display: none;">
                    <!-- Spinner akan ditambahkan oleh JS jika diperlukan atau ada di CSS -->
                     Processing...
                </div>
                <pre id="logsOutput"></pre>
            </section>
        </main>

        <footer>
            <p>Â© <span id="currentYear"></span> FreezeDroid Web Panel. For authorized use only.</p>
        </footer>
    </div>

    <script id="server-data" type="application/json">
        {{
            {
                "userPlan": js_user_plan,
                "isTrialExpired": js_is_trial_expired,
                "trialRequestsToday": js_trial_requests_today,
                "trialDailyLimit": js_trial_daily_limit
            } | tojson | safe
        }}
    </script>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>